function calculateAngle(){slope=(cursor.y-player.y)/(cursor.x-player.x);theta=Math.atan(slope)*180/Math.PI;player.x<cursor.x&&(theta+=180)}function calculateHorizontal(){player.accnetx=player.acce-player.accw;player.velx+=player.accnetx;player.x+=player.velx;player.accw>0&&player.accw--;player.acce>0&&player.acce--;if(player.velx!=0){if(player.velx>0){player.velx>player.velmax&&(player.velx=player.velmax);player.velx-=friction;player.velx<0&&(player.velx=0)}if(player.velx<0){player.velx<-player.velmax&&(player.velx=-player.velmax);player.velx+=friction;player.velx>0&&(player.velx=0)}}}function calculateVertical(){player.accnety=player.accs-player.accn;player.vely+=player.accnety;player.y+=player.vely;player.accn>0&&player.accn--;player.accs>0&&player.accs--;if(player.vely!=0){if(player.vely>0){player.vely>player.velmax&&(player.vely=player.velmax);player.vely-=friction;player.vely<0&&(player.vely=0)}if(player.vely<0){player.vely<-player.velmax&&(player.vely=-player.velmax);player.vely+=friction;player.vely>0&&(player.vely=0)}}}function movePlayer(){calculateHorizontal();calculateVertical();pc.css({top:player.y+"px",left:player.x+"px"})}function spinPlayer(){pc.css({"-webkit-transform":"rotate("+theta+"deg)","-moz-transform":"rotate("+theta+"deg)","-ms-transform":"rotate("+theta+"deg)","-o-transform":"rotate("+theta+"deg)",transform:"rotate("+theta+"deg)"})}function updatePlayer(){calculateAngle();movePlayer();spinPlayer()}function debug(){debugPlayerXPos.html(player.x);debugPlayerXVel.html(player.velx);debugPlayerXAccE.html(player.acce);debugPlayerXAccW.html(player.accw);debugPlayerXAcc.html(player.accnetx);debugPlayerYPos.html(player.y);debugPlayerYVel.html(player.vely);debugPlayerYAccN.html(player.accn);debugPlayerYAccS.html(player.accs);debugPlayerYAcc.html(player.accnety);debugCursorXPos.html(cursor.x);debugCursorYPos.html(cursor.y);debugSlope.html(slope);debugTheta.html(theta)}function setData(e){player=e.player;environment=e.environment}function initialize(e){cursor=$("#cursor");cursor.x=0;cursor.y=0;debugCursorXPos=$("#cursorxpos");debugCursorYPos=$("#cursorypos");debugSlope=$("#slope");debugTheta=$("#theta");debugPlayerXPos=$("#playerxpos");debugPlayerXVel=$("#playerxvel");debugPlayerXAccE=$("#playerxacce");debugPlayerXAccW=$("#playerxaccw");debugPlayerXAcc=$("#playerxacc");debugPlayerYPos=$("#playerypos");debugPlayerYVel=$("#playeryvel");debugPlayerYAccN=$("#playeryaccn");debugPlayerYAccS=$("#playeryaccs");debugPlayerYAcc=$("#playeryacc")}var player,environment,layer,stage,ship;$(document).ready(function(){canvas=$("#canvas");$.get("json/data.json",function(e){initialize(e);setData(e)}).error(function(){console.log("Server Error")});stage=new Kinetic.Stage({container:"canvas",width:800,height:600});layer=new Kinetic.Layer;var e=new Image;e.onload=function(){ship=new Kinetic.Image({x:stage.getWidth()/2-32,y:stage.getHeight()/2-32,image:e,width:64,height:64});layer.add(ship);stage.add(layer);var t=Math.PI/2,n=new Kinetic.Animation(function(e){var n=e.timeDiff*t/1e3;ship.rotate(n)},layer);n.start()};e.src="images/ship.png";canvas.mousemove(function(e){parentOffset=$(this).offset();cursor.x=e.pageX-parentOffset.left;cursor.y=e.pageY-parentOffset.top})});$(document).keydown(function(e){if(e.keyCode==38||e.keyCode==87){player.accn+=player.accbase;e.preventDefault()}if(e.keyCode==40||e.keyCode==83){player.accs+=player.accbase;e.preventDefault()}if(e.keyCode==37||e.keyCode==65){player.accw+=player.accbase;e.preventDefault()}if(e.keyCode==39||e.keyCode==68){player.acce+=player.accbase;e.preventDefault()}});